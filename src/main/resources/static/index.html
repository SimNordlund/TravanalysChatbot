<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">

  <title>Amorteringsunderlags analys</title>
  <style>
    #instructions {
      width: 100%;
      min-height: 150px;
      padding: 12px;
      box-sizing: border-box;
      font-size: 16px;
    }
    #drop-area {
      border: 2px dashed #ccc;
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      margin: 40px 0;
      background-color: #f8f8f8;
    }
    #drop-area.highlight {
      border-color: #4CAF50;
      background-color: #e8f5e9;
    }
    #file-input {
      display: none;
    }
    button {
      padding: 10px 15px;
      background-color: Orange;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .file-name {
      margin-top: 10px;
      font-weight: bold;
    }
    #instructions-container {
      display: none; /* Hides the entire container */
    }
  </style>
</head>
<body>
<h1>Amorteringsunderlags analys</h1>

<form id="upload-form" action="/upload" method="post" enctype="multipart/form-data">
  <div id="drop-area">
    <p>Dra amorteringsunderlaget hit</p>
    <button type="button" id="file-button">Välj fil</button>
    <input type="file" id="file-input" name="file" accept="application/pdf">
    <div class="file-name" id="file-name"></div>
  </div>

  <div id="instructions-container">
    <label for="instructions">Prompt:</label>
    <textarea id="instructions" name="instructions" rows="4" cols="50">Answer in SWEDISH. I want you to give me the following values:
You are financial advisor helper. You also answer questions regarding the documents that is provided as amorteringsunderlag and the document you got via the vector database. You answer in SWEDISH language.
Based on the Document that is provided to you via the vector database and the pdf which is a amorteringsunderlag that I sent you I want you to make a special sentence once you figured which kind of of amortization model the amorteringsunderlag is showing. I will give you some rules below:

1. When looking at Låneinformation om objekt and the values between points 1-4. If a customer only has a value under point 3. Then you should write "FI-03, Huvudregeln."
2. When looking at Låneinformation om objekt and the values between points 1-4. If a customer only has a value under point 2. Then you should write "FI-02, Huvudregeln."
3. When looking at Låneinformation om objekt and the values between points 1-4.If a customer only has a value under point 1. Then you should write "Gamla krav, omfattas ej".

4. When looking at Låneinformation om objekt and the values between points 1-4. If a customer has a value under point 1 and 2 and the same customer also has a value under point 4. Then you should write "FI-02, Alternativregeln."
5. When looking at Låneinformation om objekt and the values between points 1-4. If a customer has a value under point 2 and 3 and the same customer also has a value under point 4. Then you should write "FI-03, Alternativregeln."

6. When looking at Låneinformation om objekt and the values between points 1-4. If a customer has a value under point 1, 2, 3 and the same customer also has a value under point 4. Then you should write "FI-03, Alternativregeln."
7. When looking at Låneinformation om objekt and the values between points 1-4. If a customer has a value under point 1, 2, 3 and the same customer does not have a value under point 4. Then you should write "FI-03, Huvudregeln."

8. When looking at Låneinformation om objekt and the values between points 1-4. If a customer has a value under point 1 and 2 and the same customer does not have a value under point 4. Then you should write "FI-02, Huvudregeln."
9. When looking at Låneinformation om objekt and the values between points 1-4. If a customer has a value under point 1 and 3 and the same customer also has a value under point 4. Then you should write "Gamla krav, Alternativregeln."
10. When looking at Låneinformation om objekt and the values between points 1-4. If a customer has a value under point 1 and 3 and the same customer does not have a value under point 4. Then you should write "FI-03, Huvudregeln."
11. When looking at Låneinformation om objekt and the values between points 1-4. If a customer has a value under point 1 and 2 and the same customer does have a value under point 4. Then you should write "Gamla krav, Alternativregeln."

12. If the amorteringsunderlag does not fit anyone of these above. Please let me know that.
13. Always explain your though process when coming up with which models the customer has.
14. If you know the answer ONLY give me the answer. for example: FI-03, Huvudregeln.
    </textarea>
  </div>

  <button type="submit">Ladda upp och analysera</button>
</form>

<div id="result"></div>

<script>
  const dropArea = document.getElementById('drop-area');
  const fileInput = document.getElementById('file-input');
  const fileButton = document.getElementById('file-button');
  const fileName = document.getElementById('file-name');
  const form = document.getElementById('upload-form');
  const result = document.getElementById('result');

  // Prevent default drag behaviors
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, preventDefaults, false);
    document.body.addEventListener(eventName, preventDefaults, false);
  });

  // Highlight drop area when item is dragged over it
  ['dragenter', 'dragover'].forEach(eventName => {
    dropArea.addEventListener(eventName, highlight, false);
  });

  ['dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, unhighlight, false);
  });

  // Handle dropped files
  dropArea.addEventListener('drop', handleDrop, false);

  // Handle file selection via button
  fileButton.addEventListener('click', () => {
    fileInput.click();
  });

  fileInput.addEventListener('change', handleFiles);

  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    result.textContent = "Tänker...";

    const formData = new FormData(form);

    try {
      const response = await fetch('/upload', {
        method: 'POST',
        body: formData
      });

      const text = await response.text();
      result.innerHTML = '<h2>Resultat på analys:</h2><div>' + text.replace(/\n/g, '<br>') + '</div>';
    } catch (error) {
      result.textContent = "Error: " + error.message;
    }
  });

  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  function highlight() {
    dropArea.classList.add('highlight');
  }

  function unhighlight() {
    dropArea.classList.remove('highlight');
  }

  function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;
    handleFiles(files);
  }

  function handleFiles(e) {
    const files = e.target?.files || e;
    if (files.length) {
      fileInput.files = files;
      updateFileName(files[0].name);
    }
  }

  function updateFileName(name) {
    fileName.textContent = "Vald fil: " + name;
  }
</script>
</body>
</html>